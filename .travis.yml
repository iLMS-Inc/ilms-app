sudo: required

env:
  global:
  - secure: LdIxWrzTVMVQmODO0SAGWUmzicqbXM4/3U8C3x6k8l8kHmaEY+Lxh/K80+PkkabxD/Cyl8/OUT7IH4bk3X+Ys5Jzw9wpKnKUgimNH+T6vOE84iDu/VqzkqS69XlqZMI7Su3o1gXuPjBvuPLa/2Y71VuRx9O/LMFgusNE46XtVt0m6BI5c9UE+BUKPPoT+u4jy1z9B3O2UOpcUVDx+6G/4ONYPoVEUnh433SiL2LwYOKzhtTIqu3/bINwZ4mxjdOIxR2U/YDBg+hhPiB2zgBPlkAAZBGEQ1na1b+Fy4WtYYLNCmlF18mP9TdKBAxrYZMucGxRoUQdlptxXiTzyrCoO34W8I2dldKfrhBXoSNS4a2kWvJBlEGLiGaKFAMmPmMM9EqOTW9vW6YbnJqqnUZYRrm6vsAlDvwYSmfGSylNKQ0V4l6YWdO4P0gcdmbB6+84RnNirgWRiJAGMqrl7T6MV8COnz9bDPUrf7f1YgE0KKk1cZmK/n0LuS0JeV3rQ74J4yd8G2p48QsdcB3bOolA5CSHzBgya4TvMLAKVwcjjEypnd37FPBxhM3JybHA1D44BtnQ8BFWHRSDGJkB/lbjkfTKE53kduA/DpGmmMba5SXCO6UuYaO2qhcmHAL6zha/rPiAx26vb6aLUVfml9DcFXhTKsMO/R+7bZo12W4usrk= # DOCKER_EMAIL
  - secure: DwvS0h9ELbWu8FSS1T3ngVzguGN2o8ownKhBN4qZ345HdTV5HVSe+uEoyNuNbwUDXBeWVC7iISUNtMq503ec/jGafw6SGq7ivgrgHXC/Iqt05YYdGNmNfFpf5/S6aQHDi/60D5BcVxzQfa14u0XV79l1SoPfcCoQI1+L8Ow6sjTrKJzrr9zBgqKzXILA/z+3hU031VYvatKQTJxQREtqglXi5Bn9r4iCnNH1VDJSIsNOIKPDojmzsARn2a0ePz6mWMRgiZJYFmxQNd3SoabpeInXs2TAWn6BFLO01SMUExRy9Ryq677dAYvvjCEKiJBw7h9nZa86627rf7Ldp+vhmtYqiY89PtVC1aKvo/ti78I1pJypeUbhTidFXAMP2vuxyVG/uB+VwHfdGCYknmXpF4BDnKJ4LFpKbrU/e5W0zQTPHZ8VH5kwM1e0UslRUTJjYebxz/Kug7pSmvLL85SK26s7s6KU3gXjhUbeZBgK9wAcOnRWdUHaq0ORUkAHl83Ep0uTSHNDLgsSDXp/XrLa+DX3M8yCyCvzi59GaMWumEtERc9a2YRC46FN7sibX+KdD5W+JtRQQQQhZK45v7N+Dy0GoeCF59c5Rp08RRpsenFqp0hJeOIp3jeH25LMtunGyLHJUu+2ale7CvCGry6hjDC0F2mz0nLLUd/AbnBuCsw= # DOCKER_USER
  - secure: KLeQSLtTCcelEikB+VPrTiqmJUEYwiTmVrFgJpX324wP3cRtduZNmw4jMW0u70lDzzT/AMvpjbvXTAaUrbIfVK49BkEF+tfhVRX9fn6t5J0Djq4yPUSm9ZF0sNXXXLBE01mWAoFclUlq6KLibU52XkNYuib3yV/Q/5I/XQGTtpLzrGintKOnvjH3HCW/zkpgPwT0t/iqfdORKsaqOpk2s8K53SARq11WcEfULhIZex3O6W4W2KUmMyxtBBQmOA6E/xbaY6Bk0eT0ZDVxuECy6klsciNHsr44VS/0qwYPNuus5+ptV9pPibeKdZYN/z8hzAH1q5+YiFsmszjYGxcna0mf7v7DuE43OuSAcfskDd4BDfukNA2y9L7hanQwIjXgdt9orcP8Ja0bPbK9KAg1pCvr72Rz4/Gly/1oanyPBa6ynenWV+0hXxr/KnW0VblmyVYAQ9/XcuXViT5Omzd4pV39Pcjvgb8v6tr1c6r4JtYHdOuS1gj7Y1B/O6QsWsaNwpjkEB52mBSPke/rf9hnmMHNzfVI4wJiczfrtxu+J87WXmU5IN2m+RcUrQ7AwVuDh+3q5uNC5SBWk3HUg7QanfrxxW1pvEAzgKbGDFmPiTCrc76AJWEhk0Qn1b4uwuhzj7sGWasR+aLQ0t1Ji1w9ix5U7omQVg04y2YcSYQxqDU= # DOCKER_PASS
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: m21RGNChCp8222Pv9hjPAXU/ej+iw3tMZpzWqiVERHgnpsW+aL/4S6qS/z4qcgqzSOGlz+S0J13j9UIskLfJC4POm7YeyhnvqND3PPtbolBxkohNe2ndvYc8JhwVbe1thlC5NEiqQjD2FrNDOAwjPXu0ppeM8EtV3n/jCelmkgT/KpU5LGHgQ1c4V7iOKqO4Ya7z2UxktyqBSaqcwmiQX0tK8qFEJ5EhzMPjg+SKZfZZPMO2MHHNCb80e9d2VMWDUhY79TNFWv/SgFUbOLMQmPY7ZA8DqxODWm4ujRRrzU59CHf17MUS1NfZLs3bb10cLHNSiqmYGO1TKecjCUW6hzrCYeFoXUG7cZLIlghqr0CLbk51PxRwIos/aTZGHa700k/9QCNBcPmACIkJcRFixoTKEVWz8SL/Yi/AqbqJMawh3hmGI5JYrp3L1bGQq8kirYfYSC/MsnHI1ojFiycKjkLDFOWSZz/Odbie7IVGqk6J8ztzCYp7pUdtrSPsh/UL0cciGUeIZ9zTnnzvB+R1UFPmNu5lif/U6E1sRIqSLEkx7BHtZ21vI8Ivvg7p+NHuy0StVxCEXCKRUEdUUSfxQnh9324a0A+LbPMGC2kzF9Dj6+QLPOYek5/KQ6kK8WEqAHKP1lQfEMP4L2UZA/eLFgVRu2vonhcw77A2NBDFeVQ= # DEPLOY_HOST
  - secure: PaNvKqmF7yN+KOLyCpR4JRnvkV8LeVb+B+d7IFXU7TjDne6VGaWyHFnVmpgYTkBkxna8bOgJ92FhjIhg7VLDfZIcgGEYhMUSXUzlyiGWFfaejWYj7H03Xg5wt7iUEIqBxaAoUlWmTfsqfpFTf9P0xTjkiHGpwLCEm/ZON4zX8Pe1nmQXZlDRG5bRR8V7PXS0OBQdmHymMtT+z2sKksCjr7H5DAIm6arqy40LMLZiy90pnLDMmfRxxG/L1LkSVIdUb/BeHtOyPinzysE6d6gBIppLn2hFWbxWTOi/96YEgdF8pfjCYPzXlJPAduAC9jMrH07SO7fq0lOPbL5wZtrkBzpliAm9dE3tf7x/Fp8uJ2r1BVsQ77++lk0c10eVJx/Ib/US4Y7jlG+csileCPdm4lfJoOsMHm2Zj8/2/rbqcha/xJJNn24SoUxgqTPRkFx5vg0j0oeag4Ut96G0r+kcjQaMDD6YYEMS1mMILQit9VKQuCH3h8g8YGk7N62spi4GU7Jv14/9i9XcZyY/9hHFgqfLkqyKi/Iy/NxOwiKAVE9iAYYJ+faVx3hgla22O7bTLDuEAbL0IcF0fIG6QEX7iphlYKwaPtYZjcxqooS8EiGItBbuV5JE7fXwgRv48ZKhFbUDDoa/NYHOEXurUK4fWmijHJ71U1ut7xYhknnpi7M= # DEPLOY_USER
  - secure: U8n/ABjSZVVsl5VPOPBqABUb6qUTH2zDUKe4CBNOecWS/NocrGWhhnoYGpLGkb7lwnfXo+0iwo9gI+FqHc3stoOlZqLIbBWakyjknFMoqli4oyNYLjaj1ncaNTx8wxVV7uz089bOwSfSjM6o0pQhr+HIO60c9zA3r4addCnFJ1crHJ7OgJQc7wWtyT1bO88GNMkvrS1HvuYmvqn+3uFROSRqtZp9oSzQ5KuwPU/lCl3gamR9FT5bfYgMS9nNK9bm21cVpr0G8y5a0yPRRxV1QwAbP074kZo1kPPPwzClaSyXrOKzZGzQQ7BDovmunXTIHZDaf8mQYgmwDmZGOBmghdmDDIKW6/OztL90Qdydt4psB4WR2mmpJwF6zsPWZAEWS1fcq39ZHa5MJe4dBV9Zky9ycDa8FvaziLzGC9FKbOf/EDcS5fcYqK2kjksoHadsTpBJEqFUL4hs83mrjnlLGN2SnKVxZAFU96PWZo0YXr9/ATI+gk7jWuEfevpmbOOEmgTszuQbYfJaWfaKtMVTeO6/8ypEydMHV7dutnFQM1n/UbKjQgcyyJB5GvKrQn8ZXYBoUCWWP6Ib1vfuEiaVa3/b5JiS0aA9UjB4XcAA2QiNnHCYf9/8fl/MEbEARbhEcalHOZlvlyW1lPiOLOtrjW9ScPrNEYowMbKC9SgUlR0= # DEPLOY_PASSWORD
  - secure: RtZw2oBIyaW0eZeF4bxt3FetJ0SWvUPp2iVc0RGB4UTt8pJeaPrMnRNyOj+eE6CtB6uCiPbDFCH8df0WD6hbiG6tenfljFi3kw7Y7VLNj2qx6OhB3ZJS8P/QwyuHtMwPd9On3oPidwVn6NcDI6KuEac4oRGogUOvPBCjnA5xmAqq6lzJnrRJQA8xcLqudKsAX9nnVTZMbKk1GrzfHn7+KWMMzjlM5iZZ+oAx6WG+vN7o0NAlu87Pf7arnHO7sNLwUs+3Y36A8I+b9rp6aZSS8G0D0nPSpMjPOoZ4LvcFW2oG7WeaeYROnfnwjWtWLJeEgzWlyC3741Bdx4wu+1YkrSNIZfZapaK21LU3vEKB3CKmjzcjshRbcOycmUbg/vyvUfRPwzrl/DU+kO5c5da829bSb99XTku8si35YrAyGWz7QCPoZkgaSsVc9QCT+G99O5mzQkgVPBFGiQXipTQqxXyJvpGrf5TXnE2XJJNyX5h/wphnoIQhoc4KrbTO8E3CQkqhJRuJBY0kwrTEMvJXASAjbpAFwS9yfeHnLFNh3jUwH2sDS7ypHF//htlpI/5M026zIgjD0lUmZpuxXk7tngUvFYkdXCiAjM4AjoVdjq32CmG9tBLpt0xd+CdpiZFRkv9GjyLA5C1fMfuq5LBAqcaVfcqmSFjdmIdZGlKQog4= # DEPLOY_SCRIPT_FULL_PATH

addons:
  apt:
    packages:
      - sshpass

services:
  - docker

language: node_js

node_js:
  - '6.5'

java:
  - '1.8'

cache:
  directories:
    - $HOME/.m2

script:
  - npm install
  - npm run build
  - mvn package
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=ilms/ilms-app
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
  - export SSHPASS=$DEPLOY_PASSWORD
  - sshpass -e ssh -oStrictHostKeyChecking=no $DEPLOY_USER@$DEPLOY_HOST $DEPLOY_SCRIPT_FULL_PATH "$TRAVIS_BRANCH"
